local player = game.Players.LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local run = game:GetService("RunService")
local input = game:GetService("UserInputService")

local function safeWaitFor(obj, name)
    local ok, res = pcall(function() return obj:WaitForChild(name, 10) end)
    return ok and res or nil
end

local char = player.Character or player.CharacterAdded:Wait()
local hum = safeWaitFor(char, "Humanoid")
local root = safeWaitFor(char, "HumanoidRootPart")
if not hum or not root then return warn("❌ No se encontró el personaje.") end

local anims = safeWaitFor(rs, "Animations")
local events = safeWaitFor(rs, "Events")
local punchEvent = safeWaitFor(events, "Punch")
if not anims or not punchEvent then return warn("❌ Recursos no encontrados.") end

local punchAnims = {}
for i = 1, 5 do
    local anim = safeWaitFor(anims, "combat" .. i)
    if anim then table.insert(punchAnims, hum:LoadAnimation(anim)) end
end
if #punchAnims == 0 then return warn("❌ No se cargaron animaciones.") end

-- CONFIGURACIÓN
local delayEntreGolpes = 0.18       -- velocidad entre golpes
local velocidadAnimacion = 1.0      -- velocidad de animación visible

local combo = 0
local puedeAtacar = true
local tocandoPantalla = false

run.RenderStepped:Connect(function()
    if tocandoPantalla and puedeAtacar then
        puedeAtacar = false
        combo += 1
        if combo > 5 then combo = 1 end

        local anim = punchAnims[combo]
        anim:Play(0.1, 1, 0.3)
        anim:AdjustSpeed(velocidadAnimacion)

        punchEvent:FireServer(0, 0.1, combo)

        task.delay(delayEntreGolpes, function()
            puedeAtacar = true
        end)
    end
end)

-- Detectar clicks o taps
input.InputBegan:Connect(function(io, gp)
    if gp then return end
    if io.UserInputType == Enum.UserInputType.MouseButton1 then
        tocandoPantalla = true
    end
end)

input.InputEnded:Connect(function(io)
    if io.UserInputType == Enum.UserInputType.MouseButton1 then
        tocandoPantalla = false
    end
end)

input.TouchTapInWorld:Connect(function(_, state)
    tocandoPantalla = state
end)
