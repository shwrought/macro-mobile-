local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Acceso a animaciones y eventos
local Animations = ReplicatedStorage:WaitForChild("Animations")
local Events = ReplicatedStorage:WaitForChild("Events")
local PunchEvent = Events:WaitForChild("Punch")

-- Configuraci√≥n
local golpeDelay = 0.18
local velocidadAnim = 1.0
local combo = 0
local puedeGolpear = true
local tocando = false

-- Cargar animaciones normales de combate
local punchAnims = {}
for i = 1, 5 do
	local animObj = Animations:FindFirstChild("combat" .. i)
	if animObj then
		local anim = humanoid:LoadAnimation(animObj)
		table.insert(punchAnims, anim)
	end
end

-- Funci√≥n de golpe
local function hacerGolpe()
	if not puedeGolpear or not tocando then return end
	puedeGolpear = false

	combo += 1
	if combo > #punchAnims then
		combo = 1
	end

	local anim = punchAnims[combo]
	if anim then
		anim:Play(0.1, 1, 0.3)
		anim:AdjustSpeed(velocidadAnim)
	end

	-- Golpe normal, sin carga
	PunchEvent:FireServer(0, 0.1, combo)

	task.delay(golpeDelay, function()
		puedeGolpear = true
		if tocando then
			hacerGolpe()
		end
	end)
end

-- üì± MOBILE
UserInputService.TouchStarted:Connect(function()
	tocando = true
	hacerGolpe()
end)

UserInputService.TouchEnded:Connect(function()
	tocando = false
end)

-- üñ±Ô∏è PC
UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		tocando = true
		hacerGolpe()
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		tocando = false
	end
end)
